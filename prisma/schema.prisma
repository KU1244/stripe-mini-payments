// -----------------------------
// Prisma configuration
// -----------------------------
generator client {
  provider = "prisma-client-js" // Generates the Prisma Client (TypeScript ORM)
}

datasource db {
  provider = "postgresql" // Database type: PostgreSQL
  url      = env("DATABASE_URL") // Connection string (from .env)
}

// -----------------------------
// Stripe payment records
// -----------------------------
model Payment {
  id              String   @id @default(cuid()) // Unique record ID (auto-generated)
  stripeSessionId String   @unique // Stripe Checkout Session ID
  amount          Int // Amount in smallest currency unit (e.g., 500 = $5.00)
  currency        String   @default("usd") // Currency code (default: USD)
  status          String // Payment status ('pending', 'paid', 'failed')
  createdAt       DateTime @default(now()) // When the record was created
}

// -----------------------------
// Prevent double submission (click guard)
// -----------------------------
model PaymentRequest {
  id        String   @id @default(cuid()) // Unique record ID for click attempt
  clientRef String   @unique // Unique token per user click (prevents double submit)
  status    String   @default("pending") // 'pending' | 'succeeded' | 'failed'
  createdAt DateTime @default(now()) // Timestamp when the record was created
}

// -----------------------------
// Webhook idempotency log (prevents reprocessing on retries)
// -----------------------------
model EventLog {
  id        String   @id @default(cuid()) // Internal unique ID
  eventId   String   @unique // Stripe event.id (e.g., "evt_...")
  type      String // Stripe event type (e.g., "checkout.session.completed")
  createdAt DateTime @default(now()) // Recorded timestamp
}
